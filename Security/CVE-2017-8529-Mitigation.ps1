# https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2017-8529
function Test-RegistryValue {
    param (
        [parameter(Mandatory=$true)] [ValidateNotNullOrEmpty()]$Path,
        [parameter(Mandatory=$true)] [ValidateNotNullOrEmpty()]$Value 
    )    
    try {    
        Get-ItemProperty -Path $Path | Select-Object -ExpandProperty $Value -ErrorAction Stop | Out-Null return $true 
    }    
    catch {    
        return $false    
    }    
}

$regpath = "HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl"
$regpath64 = "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl"
$regkey = "FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"
$data = 1 

if (-not $(Test-Path "$regpath\$regkey")){
    New-Item -Path $regpath -Name $regkey
    if(-not $(Test-RegistryValue -Path "$regpath\$regkey" -Value "iexplore.exe")){
        New-ItemProperty -Path "$regpath\$regkey" -Name "iexplore.exe" -PropertyType DWord -Value $data
    }
    Else{
        Set-ItemProperty -Path "$regpath\$regkey" -Name "iexplore.exe" -PropertyType DWord -Value $data
    }
}

if ((Get-WmiObject win32_operatingsystem | Select-object osarchitecture).osarchitecture -like "64-*"){
    if (-not $(Test-Path "$regpath64\$regkey")){
        New-Item -Path $regpath64 -Name $regkey
        New-ItemProperty -Path "$regpath64\$regkey" -Name "iexplore.exe" -PropertyType DWord -Value $data
    }
}
