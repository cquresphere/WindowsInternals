# https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36884
function Test-RegistryValue {
    param (
        [parameter(Mandatory = $true)] [ValidateNotNullOrEmpty()]$Path,
        [parameter(Mandatory = $true)] [ValidateNotNullOrEmpty()]$Value 
    )    
    try {    
        Get-ItemProperty -Path $Path | Select-Object -ExpandProperty $Value -ErrorAction Stop | Out-Null return $true 
    }    
    catch {    
        return $false    
    }    
}

$values = @(
    'Excel.exe',
    'Graph.exe',
    'MSAccess.exe',
    'MSPub.exe',
    'Powerpnt.exe',
    'Visio.exe',
    'WinProj.exe',
    'WinWord.exe',
    'Wordpad.exe'
)

$data = 1

$RegPath = "HKLM :\SOFTWARE\Policies\Microsoft\Internet Explorer\Main\FeatureControl"
$regkey = "FEATURE_BLOCK_CROSS_PROTOCOL_FILE_NAVIGATION"

if (-not $(Test-Path "$Regpath\$regkey")) {
    New-Item -Path $Regpath -Name $regkey
    foreach ($value in $values) {
        New-ItemProperty -Path "$Regpath\$regkey" -Name $value -PropertyType DWord -Value $data
    }
}
Else {
    foreach ($value in $values) {
        if (-not $(Test-RegistryValue -Path "$Regpath\$regkey" -Value $value)) {
            New-ItemProperty -Path "$Regpath\$regkey" -Name $value -PropertyType DWord -Value $data
        }
        Else {
            Set-ItemProperty -Path "$Regpath\$regkey" -Name $value -PropertyType DWord -Value $data
        }
    }
}
